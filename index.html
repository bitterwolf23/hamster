<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ãƒãƒ ã‚¹ã‚¿ãƒ¼ã‚«ã‚¯ãƒ†ãƒ«å ã„</title>
  <style>
    body { margin: 0; font-family: sans-serif; background: #f2f2f2; text-align: center; }
    #chatbox { height: 200px; overflow-y: auto; border: 1px solid #ccc; margin: 20px; padding: 10px; background: white; }
    #input-area { margin: 20px; }
    canvas { width: 100vw; height: 50vh; background: #aad; }
    #shake-info, #result, #save-btn { display: none; margin: 20px; }
  </style>
</head>
<body>
  <h1>ğŸ¹ãƒãƒ ã‚¹ã‚¿ãƒ¼ã‚«ã‚¯ãƒ†ãƒ«å ã„ğŸ¹</h1>
  <div id="chatbox"></div>
  <div id="input-area">
    <input type="text" id="user-input" placeholder="ç´ æã‚’ç›¸è«‡ã—ã¦ã¿ã‚ˆã†..." />
    <button onclick="handleUserInput()">é€ä¿¡</button>
  </div>

  <canvas id="liquid-canvas"></canvas>
  <div id="shake-info">ğŸ“±ã‚·ã‚§ã‚¤ã‚¯ã—ã¦ã‚«ã‚¯ãƒ†ãƒ«ã‚’æ··ãœã‚ˆã†ï¼</div>
  <div id="result">
    <h2>ğŸ‰ã‚«ã‚¯ãƒ†ãƒ«å®Œæˆï¼ğŸ‰</h2>
    <img id="cocktail-img" src="" alt="å®Œæˆã—ãŸã‚«ã‚¯ãƒ†ãƒ«" style="width:200px;" />
    <p id="advice-text"></p>
    <button id="save-btn" onclick="saveImage()">ç”»åƒã‚’ä¿å­˜</button>
  </div>

  <script>
    const chatbox = document.getElementById('chatbox');
    const userInput = document.getElementById('user-input');
    const shakeInfo = document.getElementById('shake-info');
    const result = document.getElementById('result');
    const adviceText = document.getElementById('advice-text');

    let mixing = false;
    let shakeCount = 0;

    const materials = ['ã‚¤ãƒã‚´', 'ãƒãƒŠãƒŠ', 'ãƒŸãƒ³ãƒˆ', 'ãƒ–ãƒ«ãƒ¼ãƒ™ãƒªãƒ¼'];
    const advices = [
      'ä»Šæ—¥ã®ã‚ãªãŸã®é‹å‹¢ã¯â€œæƒ…ç†±ã®èµ¤â€ã€‚æŒ‘æˆ¦ã‚’æã‚Œãšé€²ã‚“ã§ã¿ã‚ˆã†ï¼',
      'ç¬‘é¡”ãŒå¹¸é‹ã‚’å¼•ãå¯„ã›ã‚‹æ—¥ã€‚è‡ªç„¶ä½“ã§ã„ãã¾ã—ã‚‡ã†ã€‚',
      'è¿·ã£ãŸæ™‚ã¯ä¸€åº¦ç«‹ã¡æ­¢ã¾ã£ã¦æ·±å‘¼å¸ã—ã¦ã¿ã¦ã€‚',
    ];

    function appendMessage(sender, text) {
      const div = document.createElement('div');
      div.textContent = `${sender}: ${text}`;
      chatbox.appendChild(div);
      chatbox.scrollTop = chatbox.scrollHeight;
    }

    function handleUserInput() {
      const text = userInput.value.trim();
      if (!text) return;
      appendMessage('ã‚ãªãŸ', text);

      // ç´ ææ±ºå®š
      const selected = materials[Math.floor(Math.random() * materials.length)];
      setTimeout(() => {
        appendMessage('ãƒãƒ ã‚¹ã‚¿ãƒ¼', `ãªã‚‹ã»ã©ï½ã€‚ãã‚Œãªã‚‰ã€Œ${selected}ã€ãŒè‰¯ã•ãã†ï¼`);
        setTimeout(() => {
          appendMessage('ãƒãƒ ã‚¹ã‚¿ãƒ¼', 'ã§ã¯ï¼ã‚«ã‚¯ãƒ†ãƒ«ã«æŠ•å…¥ã™ã‚‹ã­ï¼');
          startMixing(selected);
        }, 1000);
      }, 500);

      userInput.value = '';
    }

    function startMixing(material) {
      shakeInfo.style.display = 'block';
      mixing = true;
      shakeCount = 0;
    }

    window.addEventListener('deviceorientation', (event) => {
      if (!mixing) return;
      const motion = Math.abs(event.beta) + Math.abs(event.gamma);
      if (motion > 50) {
        shakeCount++;
        if (shakeCount > 15) {
          mixing = false;
          finishCocktail();
        }
      }
    });

    function finishCocktail() {
      document.getElementById('cocktail-img').src = 'https://placekitten.com/300/300'; // ä»®ç”»åƒ
      adviceText.textContent = advices[Math.floor(Math.random() * advices.length)];
      shakeInfo.style.display = 'none';
      result.style.display = 'block';
      document.getElementById('save-btn').style.display = 'inline-block';
    }

    function saveImage() {
      const link = document.createElement('a');
      link.href = document.getElementById('cocktail-img').src;
      link.download = 'my_cocktail.png';
      link.click();
    }
  </script>
</body>
</html>
